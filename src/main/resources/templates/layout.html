<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>monancho QA-Board!</title>

  <!-- Bootstrap (로컬을 사용중이면 그대로 두고, 없을 경우 CDN으로 대체 가능) -->
  <link rel="stylesheet" type="text/css" th:href="@{/bootstrap.min.css}">
  
  
  <!-- Bootstrap Icons (최신 CDN) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

  <!-- 사용자 스타일 (site-wide) -->
  <link rel="stylesheet" type="text/css" th:href="@{/style.css}">
</head>
<body class="bg-light text-dark">

  <!-- 네비게이션바 (밝고 부드러운 그림자) -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm border-0">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center gap-2" href="/monanchoboard">
        <i class="bi bi-chat-left-text-fill fs-4 text-primary" aria-hidden="true"></i>
        <span class="fw-bold">monancho QA Board</span>
      </a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMain"
              aria-controls="navbarMain" aria-expanded="false" aria-label="메뉴 토글">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarMain">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item"><a class="nav-link"  th:href="@{/question/list}">전체게시판</a></li>
          <li class="nav-item"><a class="nav-link" th:classappend="${#strings.equals(param.type, 'free')} ? ' opacity-50' : ''" th:href="@{/question/list?type=free}">자유게시판</a></li>
          <li class="nav-item"><a class="nav-link" th:classappend="${#strings.equals(param.type, 'QA')} ? ' opacity-50' : ''" th:href="@{/question/list?type=QA}">질문게시판</a></li>
          <li class="nav-item dropdown" sec:authorize="isAuthenticated()">
			  <a class="nav-link dropdown-toggle" th:classappend="${#strings.equals(param.type, 'time')} ? ' opacity-50' : ''" href="#" id="reservationDropdown" role="button"
			     data-bs-toggle="dropdown" aria-expanded="false">
			    방문예약
			  </a>
			  <ul class="dropdown-menu" aria-labelledby="reservationDropdown">
			    <!-- 예약 등록 (기존 링크 유지) -->
			    <li>
			      <a class="dropdown-item" th:href="@{/question/create?type=time}">
			        예약 등록
			      </a>
			    </li>
			
			    <!-- 예약 내역(예시) -->
			    <li>
			      <a class="dropdown-item" th:href="@{/question/list?type=time}">
			        예약 내역
			      </a>
			    </li>
			
			    <!-- 필요하면 구분선 또는 추가 항목을 넣을 수 있음 -->
			    <!-- <li><hr class="dropdown-divider"></li> -->
			    <!-- <li><a class="dropdown-item" th:href="...">다른 항목</a></li> -->
			  </ul>
			</li>
        </ul>

        <ul class="navbar-nav ms-auto align-items-center">
          <li class="nav-item me-2">
            <a class="nav-link px-2" sec:authorize="isAnonymous()" th:href="@{/user/login}">로그인</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" sec:authorize="isAnonymous()" th:href="@{/user/signup}">회원가입</a>
          </li>
          <li class="nav-item dropdown ms-3" sec:authorize="isAuthenticated()">
  <a class="nav-link dropdown-toggle d-flex align-items-center gap-2" href="#" id="mypageDropdown" role="button"
     data-bs-toggle="dropdown" aria-expanded="false" th:attr="title=${#authentication.getPrincipal().getUsername()}">
    <span class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center"
          style="width:34px; height:34px; font-weight:600; font-size:.95rem;"
          th:text="${#strings.substring(#authentication.getPrincipal().getUsername(),0,1).toUpperCase()}">U</span>
    <span class="small text-body" style="max-width:110px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"
          th:text="${#authentication.getPrincipal().getUsername()}">username</span>
  </a>

  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="mypageDropdown" style="min-width:220px;">
    <li>
      <a class="dropdown-item d-flex align-items-center gap-2" th:href="@{/user/page}">
        <i class="bi bi-person-circle"></i>
        <span>내 정보</span>
      </a>
    </li>
    <li><hr class="dropdown-divider"></li>
    <li>
      <!-- 로그아웃은 POST 폼 -->
      <form th:action="@{/user/logout}" method="post" class="px-3 py-2 m-0">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        <button type="submit" class="btn btn-outline-danger w-100 d-flex align-items-center justify-content-center gap-2"
                onclick="return confirm('정말 로그아웃 하시겠습니까?');">
          <i class="bi bi-box-arrow-right"></i>
          <span>로그아웃</span>
        </button>
      </form>
    </li>
  </ul>
</li>

        </ul>
      </div>
    </div>
  </nav>

  <!-- 메인 컨테이너: 각 페이지의 내용이 이곳에 들어감 -->
  <main class="container py-4">
    <th:block layout:fragment="content"></th:block>
  </main>

  <!-- (선택) 푸터 -->
  <footer class="mt-auto py-3">
    <div class="container text-center text-muted small">
      © <span th:text="${#dates.format(#dates.createNow(), 'yyyy')}">2025</span> monancho · All rights reserved.
    </div>
  </footer>

  <!-- 페이지 별 스크립트 삽입 -->
  <th:block layout:fragment="script"></th:block>

  <!-- Bootstrap JS: 로컬을 사용 중이면 th:src 유지, 아니면 CDN으로 대체 -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
